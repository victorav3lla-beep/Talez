<div class="story-card" data-controller="story-card">
  <!-- Image (first AI-generated image from chat) -->
  <div class="card-img-wrapper">
    <% first_image = story.chats.first&.messages&.where(image_url: nil)&.first&.image_url %>
    <%= image_tag first_image || 'https://via.placeholder.com/300x400?text=Story', class: 'card-img', alt: story.title %>

    <!-- Status Badge Overlay -->
    <div class="card-status-badge">
      <span class="badge <%= story.public? ? 'badge-public' : 'badge-draft' %>">
        <%= story.public? ? 'ðŸ“– Public' : 'ðŸ“ Draft' %>
      </span>
    </div>
  </div>

  <!-- Card Body -->
  <div class="card-body-enhanced">
    <!-- Title -->
    <h5 class="story-title-enhanced">
      <%= story.title || 'Untitled Story' %>
    </h5>

    <!-- Character & Universe Info with Emojis -->
    <div class="story-meta-enhanced">
      <!-- Character Info -->
      <% if story.characters.any? %>
        <div class="meta-item">
          <span class="meta-emoji">ðŸ§™</span>
          <span class="meta-text"><%= story.characters.first.name %></span>
        </div>
      <% end %>

      <!-- Universe Info -->
      <% if story.universes.any? %>
        <div class="meta-item">
          <span class="meta-emoji">ðŸŒ²</span>
          <span class="meta-text"><%= story.universes.first.name %></span>
        </div>
      <% end %>
    </div>

    <!-- Progress Bar -->
    <% messages_count = story.chats.first&.messages&.count || 0 %>
    <% progress_percent = [[(messages_count * 10), 100].min, 5].max %>
    <div class="progress-wrapper">
      <div class="progress-bar-custom">
        <div class="progress-fill" style="width: <%= progress_percent %>%;" data-progress="<%= progress_percent %>"></div>
      </div>
      <span class="progress-text"><%= progress_percent %>%</span>
    </div>

    <!-- Timestamp -->
    <div class="story-timestamp">
      <i class="far fa-clock"></i>
      <%= time_ago_in_words(story.updated_at) %> ago
    </div>

    <!-- Action Buttons -->
    <div class="card-actions-bottom">
      <%= link_to story_path(story), class: 'btn-continue' do %>
        <i class="fas fa-play"></i>
        Continue
      <% end %>

      <div class="action-icons">
        <%= button_to story_path(story), method: :patch,
            params: { story: { public: !story.public } },
            class: 'btn-action btn-share-action',
            title: story.public? ? 'Make Private' : 'Make Public',
            form: { data: { turbo: false } } do %>
          <i class="fas fa-share-alt"></i>
        <% end %>

        <%= button_to story_path(story), method: :delete,
            data: { turbo_confirm: 'Are you sure you want to delete this story?' },
            class: 'btn-action btn-delete-action',
            title: 'Delete Story',
            form: { data: { turbo: false } } do %>
          <i class="fas fa-trash-alt"></i>
        <% end %>
      </div>
    </div>
  </div>
</div>
