<div class="dashboard-container" data-controller="success-animation">
  <!-- Flash Messages (Hidden) -->
  <% if flash[:success] == 'story_created' %>
    <div data-flash-success="story_created" style="display: none;"></div>
    ‚Ñ¢  <% end %>
  <!-- Sidebar -->
  <%= render 'shared/sidebar', active: 'dashboard' %>
  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Header -->
    <%= render 'shared/header', profile: @profile %>
    <!-- Hero Carousel Section -->
    <section class="hero-carousel-section" data-controller="hero-carousel">
      <!-- Progress Badge -->
      <div class="progress-badge" data-hero-carousel-target="progressBadge">
        <span class="progress-text">
          You've created
          <span class="progress-count" data-hero-carousel-target="storyCount">
            <%= @my_stories.count %>
          </span>
          stories this week! üåü
        </span>
      </div>
      <!-- Bootstrap Carousel -->
      <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="5000">
        <!-- Carousel Indicators -->
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
        </div>
        <!-- Carousel Inner -->
        <div class="carousel-inner">
          <!-- Slide 1: Adventure with Dog -->
          <div class="carousel-item active" data-cta-text="Start Your Adventure">
            <div class="carousel-content">
              <div class="carousel-text">
                <h1 class="carousel-title">Ready for an adventure?</h1>
                <p class="carousel-subtitle">Create amazing stories with your favorite characters!</p>
                <%= link_to characters_path, class: 'btn-create-story-hero', data: {
                  hero_carousel_target: "ctaButton",
                  action: "mouseenter->hero-carousel#buttonHover mouseleave->hero-carousel#buttonLeave"
                } do %>
                  <span class="btn-icon">
                    <i class="fas fa-plus-circle"></i>
                  </span>
                  <span class="btn-text" data-hero-carousel-target="ctaText">Create New Story</span>
                  <div class="btn-glow"></div>
                <% end %>
              </div>
              <div class="carousel-image">
                <div class="floating-character">
                  <%= image_tag 'hero_main.jpeg', alt: 'Kid with dog', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <div class="sparkle sparkle-1"></div>
                  <div class="sparkle sparkle-2"></div>
                  <div class="sparkle sparkle-3"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- Slide 2: Wizard Magic -->
          <div class="carousel-item" data-cta-text="Create Magic">
            <div class="carousel-content">
              <div class="carousel-text">
                <h1 class="carousel-title">Create magical stories!</h1>
                <p class="carousel-subtitle">Cast spells and discover enchanted worlds!</p>
                <%= link_to characters_path, class: 'btn-create-story-hero', data: {
                  hero_carousel_target: "ctaButton",
                  action: "mouseenter->hero-carousel#buttonHover mouseleave->hero-carousel#buttonLeave"
                } do %>
                  <span class="btn-icon">
                    <i class="fas fa-plus-circle"></i>
                  </span>
                  <span class="btn-text" data-hero-carousel-target="ctaText">Create New Story</span>
                  <div class="btn-glow"></div>
                <% end %>
              </div>
              <div class="carousel-image">
                <div class="floating-character">
                  <%= image_tag 'hero-wizard.png', alt: 'Wizard casting spell', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <%= image_tag 'enchanted_forest.jpg', alt: 'Enchanted Forest', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <div class="sparkle sparkle-1"></div>
                  <div class="sparkle sparkle-2"></div>
                  <div class="sparkle sparkle-3"></div>
                  <div class="sparkle sparkle-4"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- Slide 3: Space Adventure -->
          <div class="carousel-item" data-cta-text="Explore New Worlds">
            <div class="carousel-content">
              <div class="carousel-text">
                <h1 class="carousel-title">Explore new worlds!</h1>
                <p class="carousel-subtitle">Blast off into space for epic adventures!</p>
                <%= link_to characters_path, class: 'btn-create-story-hero', data: {
                  hero_carousel_target: "ctaButton",
                  action: "mouseenter->hero-carousel#buttonHover mouseleave->hero-carousel#buttonLeave"
                } do %>
                  <span class="btn-icon">
                    <i class="fas fa-plus-circle"></i>
                  </span>
                  <span class="btn-text" data-hero-carousel-target="ctaText">Create New Story</span>
                  <div class="btn-glow"></div>
                <% end %>
              </div>
              <div class="carousel-image">
                <div class="floating-character">
                  <%= image_tag 'hero-spaceship.jpg', alt: 'Spaceship in space', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <%= image_tag 'galaxy_beyond.jpg', alt: 'A galaxy beyond', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <div class="sparkle sparkle-1"></div>
                  <div class="sparkle sparkle-2"></div>
                  <div class="sparkle sparkle-3"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- Slide 4: Dragon Adventure -->
          <div class="carousel-item" data-cta-text="Befriend a Dragon">
            <div class="carousel-content">
              <div class="carousel-text">
                <h1 class="carousel-title">Befriend a Dragon!</h1>
                <p class="carousel-subtitle">Embark on legendary quests in a world of fantasy.</p>
                <%= link_to characters_path, class: 'btn-create-story-hero', data: {
                  hero_carousel_target: "ctaButton",
                  action: "mouseenter->hero-carousel#buttonHover mouseleave->hero-carousel#buttonLeave"
                } do %>
                  <span class="btn-icon">
                    <i class="fas fa-plus-circle"></i>
                  </span>
                  <span class="btn-text" data-hero-carousel-target="ctaText">Create New Story</span>
                  <div class="btn-glow"></div>
                <% end %>
              </div>
              <div class="carousel-image">
                <div class="floating-character">
                  <%= image_tag 'hero_dragon.jpg', alt: 'A friendly dragon', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <div class="sparkle sparkle-1"></div>
                  <div class="sparkle sparkle-2"></div>
                  <div class="sparkle sparkle-3"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Carousel Controls -->
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true">
            <i class="fas fa-chevron-left"></i>
          </span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true">
            <i class="fas fa-chevron-right"></i>
          </span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </section>
    <!-- Continue Reading Card (Separate) -->
    <% if @continue_reading %>
      <section class="continue-reading-section">
        <div class="continue-reading-card">
          <h3>
            <i class="fas fa-book-reader"></i>
            Continue Reading
          </h3>
          <div class="story-thumb-wrapper">
            <% first_image = @continue_reading.cover.attached? ? @continue_reading.cover : @continue_reading.pages.order(:position).first&.image %>
            <% if first_image&.attached? %>
              <%= image_tag first_image, class: 'story-thumb' %>
            <% else %>
              <%= image_tag 'default-story.png', class: 'story-thumb', alt: 'Default story' %>
            <% end %>
          </div>
          <p class="story-title"><%= @continue_reading.title || 'Untitled Story' %></p>
          <%= link_to story_path(@continue_reading), class: 'btn btn-sm btn-aqua' do %>
            <i class="fas fa-play"></i>
            Continue
          <% end %>
        </div>
      </section>
    <% end %>
    <!-- My Favorite Stories -->
    <% if @bookmarked_stories.any? %>
      <section class="favorite-stories">
        <h2>
          <i class="fas fa-star"></i>
          My favorite stories
        </h2>
        <div class="stories-scroll">
          <% @bookmarked_stories.each do |story| %>
            <%= render 'story_card', story: story %>
          <% end %>
        </div>
      </section>
    <% end %>
    <!-- Main Content Area with Stats Sidebar -->
    <div class="content-with-sidebar">
      <!-- Stories Section (Left/Main) -->
      <section class="stories-section-main" data-controller="story-filter">
        <!-- All My Stories -->
        <div class="my-stories">
          <%= render 'story_filters' %>
          <% if @my_stories.any? %>
            <div class="stories-grid" data-story-filter-target="grid">
              <% @my_stories.each do |story| %>
                <div class="story-card-wrapper"
                     data-story-filter-target="card"
                     data-status="<%= story.status || 'draft' %>"
                     data-public="<%= story.public? %>"
                     data-created-at="<%= story.created_at.to_i %>"
                     data-likes="<%= story.likes_count || 0 %>">
                  <%= render 'story_card', story: story %>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="empty-state-enhanced">
              <div class="empty-state-content-enhanced">
                <div class="empty-state-icon-large">üìñ</div>
                <h3>Your story library is empty</h3>
                <p>Let's create your first magical adventure!</p>
                <div class="empty-state-steps">
                  <div class="step-item">
                    <span class="step-emoji">‚ú®</span>
                    <span class="step-text">Choose a hero</span>
                  </div>
                  <div class="step-item">
                    <span class="step-emoji">üåç</span>
                    <span class="step-text">Pick a universe</span>
                  </div>
                  <div class="step-item">
                    <span class="step-emoji">üìù</span>
                    <span class="step-text">Tell your story</span>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </section>
      <!-- Stats Sidebar (Right) -->
      <%= render 'stats_sidebar' %>
    </div>
  </div>
</div>
