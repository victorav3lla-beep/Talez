<div class="dashboard-page-wrapper">
<div class="dashboard-container" data-controller="success-animation">
  <!-- Flash Messages (Hidden) -->
  <% if flash[:success] == 'story_created' %>
    <div data-flash-success="story_created" style="display: none;"></div>
    ‚Ñ¢  <% end %>
  <!-- Sidebar -->
  <%= render 'shared/sidebar', active: 'dashboard' %>
  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Header -->
    <%= render 'shared/header', profile: @profile %>
    <!-- Hero Carousel Section -->
    <section class="hero-carousel-section" data-controller="hero-carousel">
      <!-- Progress Badge -->
      <div class="progress-badge" data-hero-carousel-target="progressBadge">
        <span class="progress-text">
          You've created
          <span class="progress-count" data-hero-carousel-target="storyCount">
            <%= @my_stories.count %>
          </span>
          stories this week! üåü
        </span>
      </div>
      <!-- Bootstrap Carousel -->
      <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="5000">
        <!-- Carousel Indicators -->
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
        </div>
        <!-- Carousel Inner -->
        <div class="carousel-inner">
          <!-- Slide 1: Storybook Adventure -->
          <div class="carousel-item active" data-cta-text="Open Your Story">
            <div class="carousel-content">
              <div class="carousel-text">
                <h1 class="carousel-title">Ready for an adventure?</h1>
                <p class="carousel-subtitle">Create amazing stories with your favorite characters!</p>
                <%= link_to characters_path, class: 'btn-create-story-hero', data: {
                  hero_carousel_target: "ctaButton",
                  action: "mouseenter->hero-carousel#buttonHover mouseleave->hero-carousel#buttonLeave"
                } do %>
                  <span class="btn-icon">
                    <i class="fas fa-book-open"></i>
                  </span>
                  <span class="btn-text" data-hero-carousel-target="ctaText">Open Your Story</span>
                  <div class="btn-glow"></div>
                <% end %>
              </div>
              <div class="carousel-image">
                <div class="floating-character">
                  <%= image_tag 'hero_main.jpeg', alt: 'Storybook adventure with characters', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <div class="sparkle sparkle-1"></div>
                  <div class="sparkle sparkle-2"></div>
                  <div class="sparkle sparkle-3"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- Slide 2: Wizard Magic -->
          <div class="carousel-item" data-cta-text="Cast Your Spell">
            <div class="carousel-content">
              <div class="carousel-text">
                <h1 class="carousel-title">Create magical stories!</h1>
                <p class="carousel-subtitle">Cast spells and discover enchanted worlds!</p>
                <%= link_to characters_path, class: 'btn-create-story-hero', data: {
                  hero_carousel_target: "ctaButton",
                  action: "mouseenter->hero-carousel#buttonHover mouseleave->hero-carousel#buttonLeave"
                } do %>
                  <span class="btn-icon">
                    <i class="fas fa-magic"></i>
                  </span>
                  <span class="btn-text" data-hero-carousel-target="ctaText">Cast Your Spell</span>
                  <div class="btn-glow"></div>
                <% end %>
              </div>
              <div class="carousel-image">
                <div class="floating-character">
                  <%= image_tag 'hero-wizard.png', alt: 'Wizard casting spell', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <%= image_tag 'enchanted_forest.jpg', alt: 'Enchanted Forest', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <div class="sparkle sparkle-1"></div>
                  <div class="sparkle sparkle-2"></div>
                  <div class="sparkle sparkle-3"></div>
                  <div class="sparkle sparkle-4"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- Slide 3: Space Adventure -->
          <div class="carousel-item" data-cta-text="Launch Into Space">
            <div class="carousel-content">
              <div class="carousel-text">
                <h1 class="carousel-title">Explore new worlds!</h1>
                <p class="carousel-subtitle">Blast off into space for epic adventures!</p>
                <%= link_to characters_path, class: 'btn-create-story-hero', data: {
                  hero_carousel_target: "ctaButton",
                  action: "mouseenter->hero-carousel#buttonHover mouseleave->hero-carousel#buttonLeave"
                } do %>
                  <span class="btn-icon">
                    <i class="fas fa-rocket"></i>
                  </span>
                  <span class="btn-text" data-hero-carousel-target="ctaText">Launch Into Space</span>
                  <div class="btn-glow"></div>
                <% end %>
              </div>
              <div class="carousel-image">
                <div class="floating-character">
                  <%= image_tag 'hero-spaceship.jpg', alt: 'Spaceship in space', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <%= image_tag 'galaxy_beyond.jpg', alt: 'A galaxy beyond', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <div class="sparkle sparkle-1"></div>
                  <div class="sparkle sparkle-2"></div>
                  <div class="sparkle sparkle-3"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- Slide 4: Dragon Adventure -->
          <div class="carousel-item" data-cta-text="Awaken the Dragon">
            <div class="carousel-content">
              <div class="carousel-text">
                <h1 class="carousel-title">Befriend a Dragon!</h1>
                <p class="carousel-subtitle">Embark on legendary quests in a world of fantasy.</p>
                <%= link_to characters_path, class: 'btn-create-story-hero', data: {
                  hero_carousel_target: "ctaButton",
                  action: "mouseenter->hero-carousel#buttonHover mouseleave->hero-carousel#buttonLeave"
                } do %>
                  <span class="btn-icon">
                    <i class="fas fa-fire"></i>
                  </span>
                  <span class="btn-text" data-hero-carousel-target="ctaText">Awaken the Dragon</span>
                  <div class="btn-glow"></div>
                <% end %>
              </div>
              <div class="carousel-image">
                <div class="floating-character">
                  <%= image_tag 'hero_dragon.jpg', alt: 'A friendly dragon', class: 'hero-img', onerror: "this.src='#{image_path('default-story.png')}'" %>
                  <div class="sparkle sparkle-1"></div>
                  <div class="sparkle sparkle-2"></div>
                  <div class="sparkle sparkle-3"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Carousel Controls -->
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true">
            <i class="fas fa-chevron-left"></i>
          </span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true">
            <i class="fas fa-chevron-right"></i>
          </span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
      <!-- Big CTA Button -->
      <div class="hero-cta-container">
        <%= link_to characters_path, class: 'btn-hero-cta' do %>
          <span class="btn-hero-icon">
            <i class="fas fa-rocket"></i>
          </span>
          <span class="btn-hero-text">Start Your Adventure</span>
        <% end %>
      </div>
    </section>
    <!-- All My Stories Carousel -->
    <% carousel_stories = @profile.stories.order(updated_at: :desc).limit(5) %>
    <% if carousel_stories.any? %>
      <section class="all-stories-carousel-section">
        <h2 class="carousel-section-title">
          <i class="fas fa-book"></i>
          All My Stories
        </h2>
        <div id="storiesCarousel" class="stories-scroll-wrapper" data-controller="stories-carousel">
          <button class="scroll-arrow scroll-arrow-left" data-action="click->stories-carousel#scrollLeft">
            <i class="fas fa-chevron-left"></i>
          </button>

          <div class="stories-scroll-container">
            <% carousel_stories.each do |story| %>
              <div class="continue-reading-card">
                <div class="story-thumb-wrapper">
                  <% first_image = story.cover.attached? ? story.cover : story.pages.order(:position).first&.image %>
                  <% if first_image&.attached? %>
                    <%= image_tag first_image, class: 'story-thumb' %>
                  <% else %>
                    <%= image_tag 'default-story.png', class: 'story-thumb', alt: 'Default story' %>
                  <% end %>
                </div>
                <p class="story-title"><%= story.title || 'Untitled Story' %></p>
                <%= link_to story_path(story), class: 'btn btn-sm btn-aqua' do %>
                  <i class="fas fa-play"></i>
                  Continue
                <% end %>
              </div>
            <% end %>
          </div>

          <button class="scroll-arrow scroll-arrow-right" data-action="click->stories-carousel#scrollRight">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </section>
    <% end %>
    <!-- Main Content Area with Stats Sidebar -->
    <div class="content-with-sidebar">
      <!-- Best User's Stories Carousel (Left/Main) -->
      <% best_community_stories = Story.where(public: true).order(likes_count: :desc).limit(10) %>
      <section class="best-stories-section-main">
        <h2 class="section-title">
          <i class="fas fa-trophy"></i>
          Best User's Stories
        </h2>
        <% if best_community_stories.any? %>
          <div class="best-stories-scroll-wrapper" data-controller="stories-carousel">
            <button class="scroll-arrow scroll-arrow-left" data-action="click->stories-carousel#scrollLeft">
              <i class="fas fa-chevron-left"></i>
            </button>

            <div class="stories-scroll-container">
              <% best_community_stories.each do |story| %>
                <%= render 'story_card', story: story %>
              <% end %>
            </div>

            <button class="scroll-arrow scroll-arrow-right" data-action="click->stories-carousel#scrollRight">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        <% else %>
          <div class="empty-state-enhanced">
            <div class="empty-state-content-enhanced">
              <div class="empty-state-icon-large">üèÜ</div>
              <h3>No community stories yet</h3>
              <p>Be the first to share a public story!</p>
            </div>
          </div>
        <% end %>
      </section>
      <!-- Stats Sidebar (Right) -->
      <%= render 'stats_sidebar' %>
    </div>
  </div>
</div>
</div>
