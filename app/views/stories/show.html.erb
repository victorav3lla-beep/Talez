<div class="container story-show m-5-auto p-4 bg-light rounded">
  <h1><%= @story.title %></h1>
  <hr>

  <% if @story.cover.attached? %>
    <%= image_tag @story.cover, alt: @story.title, class: "story-cover mb-4" %>
  <% elsif @story.images.attached? %>
    <!-- Fallback for old stories with images -->
    <% @story.images.each do |image| %>
      <%= image_tag image, alt: @story.title, class: "story-cover mb-4" %>
    <% end %>
  <% end %>

  <div class="pages-container">
    <% @story.pages.order(:position).each do |page| %>
      <div class="page mb-5 p-4 bg-white rounded">
        <h3><%= page.title %></h3>
        <p><%= simple_format(page.content) %></p>

        <% if page.image.attached? %>
          <%= image_tag page.image, alt: page.title, class: "page-image", loading: "lazy" %>
        <% end %>
      </div>
    <% end %>
  </div>

  <hr>

  <% if @story.pages.count < 3 %>
    <div class="add-page-form p-4 bg-white rounded mb-4">
      <h4>Continue your story...</h4>
      <%= simple_form_for :page, local: true, url: add_page_story_path(@story), method: :post do |f| %>
        <%= f.input :content,
                    label: false,
                    required: true,
                    as: :text,
                    input_html: {
                      rows: 4,
                      class: 'prompt-input',
                      placeholder: 'What happens next?'
                    } %>
        <%= f.button :submit, "Add Page", class: "btn btn-success btn-lg w-100 mt-2" %>
      <% end %>
    </div>
  <% else %>
    <p class="alert alert-info">Your story is complete! Check back for the cover.</p>
  <% end %>

  <div class="d-flex justify-content-center gap-3">
    <%= link_to "Back to Dashboard", dashboard_path, class: "btn btn-warning btn-lg" %>
    <%= link_to "Create New Story", new_story_path, class: "btn btn-success btn-lg" %>
  </div>
</div>
